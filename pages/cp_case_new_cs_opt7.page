<!-- 
/**
* @author Original: Limo Sadalla - Cloud Sherpas/Mathworks, Last Modified: Jesfer Baculod, Kishore An
* @date Original: 26 June 2013, Last Modified: 23 September 2013
* @description page on Customer Portal for creating Case  
*/ 
-->
<apex:page Controller="cp_Case_new_ControllerExtension" standardStylesheets="false" sidebar="false" showHeader="false">
	<apex:includeScript value="{!$Resource.jquery_191}"/>
    <apex:stylesheet value="{!$Resource.MWcreatecasestyles}"/>
    <apex:stylesheet value="{!$Resource.MWHeaderStyles}"/>
    <apex:stylesheet value="{!$Resource.MWnextgenstyles}"/>
    <apex:stylesheet value="{!$Resource.MWExternalStyle960}"/>
    
    
     <style>
        .list td a{ color: #000 !important; text-decoration: none; }
        form#filter_element { padding-top: 10px; margin-left: 0px; display: inline-block; } 
        .bNext { padding-top: 3px; margin-right: 30px; display: inline-block; float: right; }
       .secondaryPalette{width:50%, margin-left:25%}
       .mwheader{width:50%, margin-left:25%}
       html body {
        height: 100%;
        padding: 0px;
        margin: 0px;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 62.5%;
        color: #3C3C3C;
        line-height: 140%;
        background: #D6D6D6 url({!$Resource.BodyBackground}) repeat-x top left;
        overflow-y: scroll;
        -webkit-font-smoothing: antialiased;
      }
      
       .mwa-nav a
      {
      font-size: 1.1em;
      }
      
      h1 {
      font-weight: bold !important;
      letter-spacing: 0em !important;
      }
      form {
        font-size: 13px;
      }
      
	.content_container{
	    padding-left:0px !important;
	    width:99%;
	}
	.warning{margin-left:0px;margin-top:15px;}
	h3{font-family: Arial, Helvetica, sans-serif;} 
     </style>   

     <script>
        var visitorChoice = 'a6';
        if ({!isDistributor} && !{!isStudent}){
            visitorChoice = 'a6b';
        }
        var fieldsNotPopulated ='';
        var invalidLicenseFields ='';
        
        function checkRequiredFields(choicevalue,selTask){
            document.getElementById('notficationSection').innerHTML ='';
            document.getElementById('notficationSection').style.display ="none";
            var infoMessage = '<br/><p>{!$Label.Create_case_Warning_Message}</p><ul>';
      
            clearCssOnFields(requiredFieldArr[visitorChoice]);
            clearCssOnFields(licenseFieldArr[visitorChoice]);
            
            invalidLicenseFields =''
            fieldsNotPopulated='';
            
            //Check required field if not blank
            if(requiredFieldArr[choicevalue] != null && requiredFieldArr[choicevalue] != ''){
                reqFields = requiredFieldArr[choicevalue].split(',');

                if(reqFields.length>0){
                    for(ctr=0;ctr<reqFields.length;ctr++){
                        if(document.getElementById(reqFields[ctr]) != null){
                            if(document.getElementById(reqFields[ctr]).value=='' ){
                                var shouldBeRequired = true;
                                if(dependencyField[reqFields[ctr]]!=null){
                                    
                                    shouldBeRequired = false;
                                    dependentFieldId = dependencyField[reqFields[ctr]].split('%2C');
                                    for(ctr2=0;ctr2<dependentFieldId.length;ctr2++){
                                        if(document.getElementById(dependentFieldId[ctr2])!=null){
                                            currentRadioButtonState = document.getElementById(dependentFieldId[ctr2]).checked
                                            shouldBeRequired=shouldBeRequired||currentRadioButtonState;
                                        }
                                    }
                                }
                                if(shouldBeRequired){
                                    if(fieldsNotPopulated.length>0){
                                        fieldsNotPopulated+=',';
                                    }
                                    fieldsNotPopulated+=reqFields[ctr];
                                }
                            }
                        }else{
                            //alert('Missing:'+reqFields[ctr]);
                        }
                    }
                }
            }
            // License entry validation
            if(licenseFieldArr[choicevalue] != null && licenseFieldArr[choicevalue] != ''){
                licFields = licenseFieldArr[choicevalue].split(',');
                if(licFields.length>0){
                    for(ctr=0;ctr<licFields.length;ctr++){
                        if(document.getElementById(licFields[ctr]) != null){
                            var licenseVal = document.getElementById(licFields[ctr]).value
                            
                            if(licenseVal!='' ){
                                var licNotValid = true;
                                if((licenseVal.toUpperCase() == "STUDENT" || licenseVal.toUpperCase() == "DEMO" || !(isNaN(licenseVal))) && ((licenseVal.replace(/\s/g, '').length)>0) && ((licenseVal.length)==(licenseVal.replace(/\s/g, '').length)) ){
                                    licNotValid = false;
                                }
                                if(licNotValid){
                                    if(invalidLicenseFields.length>0){
                                        invalidLicenseFields+=',';
                                    }
                                    invalidLicenseFields+=licFields[ctr];
                                }
                                
                            }
                        }else{
                            alert('Missing:'+licFields[ctr]);
                        }
                    }
                }
            }
            
            if(fieldsNotPopulated.length==0 && choicevalue!='' && invalidLicenseFields.length==0 ){
                createcase(selTask);
            }else{
                if(fieldsNotPopulated.length>0){
                    unPopulatedfields = fieldsNotPopulated.split(',');
                    for(ctr=0;ctr<unPopulatedfields.length;ctr++){
                        //document.getElementById(unPopulatedfields[ctr]).setAttribute("class","textfield required");
                        textlength = unPopulatedfields[ctr].split(':').length;
                        originalId = (unPopulatedfields[ctr].split(':'))[textlength-1];
                        document.getElementById(originalId+'div').setAttribute("class","form_element field_error");
                        document.getElementById(originalId+'span').setAttribute("style","display:none");
                        infoMessage+='<li id="infoMessage'+ctr+'">Please enter a valid '+document.getElementById(originalId+'div').getAttribute("name")+'</li>';
                    }
                }
                if(invalidLicenseFields.length>0){
                    invalidLicenses = invalidLicenseFields.split(',');
                    for(ctr=0;ctr<invalidLicenses.length;ctr++){
                        //document.getElementById(invalidLicenses[ctr]).setAttribute("class","textfield required");
                        textlength = invalidLicenses[ctr].split(':').length;
                        originalId = (invalidLicenses[ctr].split(':'))[textlength-1];
                        document.getElementById(originalId+'div').setAttribute("class","form_element field_error");
                        var element = document.getElementById(originalId+'span');
                        if (element != null) {
                            document.getElementById(originalId+'span').setAttribute("style","display:none");
                        }
                        infoMessage+='<li id="infoMessageInvalid'+ctr+'">Invalid '+document.getElementById(originalId+'div').getAttribute("name")+' value</li>';
                    }
                }
                infoMessage+='</ul>';
                document.getElementById('notficationSection').innerHTML = infoMessage;
                document.getElementById('notficationSection').style.display="block";
            }
        }
        
        
        
        function clearCssOnFields(fields2Clear){
            fieldIdToClearList = fields2Clear;
            fieldIdToClear = fieldIdToClearList.split(',');
            for(ctr=0;ctr<fieldIdToClear.length;ctr++){
                //document.getElementById(fieldIdToClear[ctr]).setAttribute("class","");
                textlength = fieldIdToClear[ctr].split(':').length;
                originalId = (fieldIdToClear[ctr].split(':'))[textlength-1];
                document.getElementById(originalId+'div').setAttribute("class","form_element");
                var element = document.getElementById(originalId+'span');
                if (element != null) {
                    document.getElementById(originalId+'span').setAttribute("style","");
                }
            }
        }
       
        
        function reloadParentFrame(caseId){
            //Case not created, an email has been forwarded to Distributor
            if (caseId == ''){
                window.parent.location.href = '/apex/cp_case_new_forwardemail_notification?de={!distributoremailaddress}'; 
            }
            //Created a Case
            else {
                  if({!isssoenabled}){
                    window.location.href = parent.location.hostname + '/apex/cp_case_detail?cc={!$CurrentPage.parameters.CC}';
                    window.parent.location.href = '/apex/cp_case_detail?id='+caseId + '&isnew=yes&cc={!$CurrentPage.parameters.CC}';
                   }else{
                       parent.location.href = parent.location.hostname + '/apex/cp_case_detail';
                       window.top.location.href = '/apex/cp_case_detail?id='+caseId + '&isnew=yes&cc={!$CurrentPage.parameters.CC}';
                   }
            }
        }
        
        function createcancel() { 
            var loc = parent.location.href.split("?")[0];           
            if({!isssoenabled}){            
                if({!isDistributor}){            
                    window.parent.location.href = loc + '?page=cp_case_home';
                    window.top.location.href = '/apex/cp_case_home?cc={!$CurrentPage.parameters.CC}';
                }else if({!NOT(isDistributor)} && {!NOT(hasMWOffice)}){
                    window.top.location.href = '{!$Label.mw_domain_url}/company/aboutus/contactus.html';
                }
                else{
                    window.parent.location.href = loc + '?page=cp_case_home';
                    window.top.location.href = '/apex/cp_case_home?cc={!$CurrentPage.parameters.CC}';
                }
            }else{
                window.top.location.href = '/apex/cp_case_home?cc={!$CurrentPage.parameters.CC}';
            }
        }
        

</script>

<body id="nextgen_b" class="search_template">
<apex:outputPanel layout="block" styleclass="container_192" >
<apex:outputPanel layout="block" styleclass="grid_192" >
<apex:outputPanel layout="block" styleClass="page_container">
    <apex:include pageName="cp_header" />
<apex:outputPanel layout="block" styleclass="content_frame" >
    <apex:outputPanel layout="block" styleClass="grid_192" id="iframeGrid_192">
        <apex:outputPanel layout="block" styleClass="content_container" id="content_container">
        
        <apex:form id="mainFrm">
	    <apex:actionFunction action="{!createcase}" name="createcase" status="saving" rerender="none" oncomplete="reloadParentFrame('{!CaseObj.Id}');">
	        <apex:param name="selTask" value="{!selTask}" assignTo="{!selTask}" />
	    </apex:actionFunction>
	    <div class="warning" id="notficationSection" style="display:none;"></div>
	    <br/>
		<p><span class="req">*</span><strong>Indicates Required Information</strong></p>
          
		  <div class="form_element" id="csgcslicense_6div" name="License #">
		    <apex:outputlabel rendered="{!if(isStudent == false, true,false)}" escape="false">
		            License #:
		    </apex:outputlabel>
		    <apex:outputlabel rendered="{!if(isStudent == true, true,false)}" escape="false">
		            <span class="req" id="csgcslicense_6span"></span>License #:
		    </apex:outputlabel>
		    <apex:inputText id="csgcslicense_6" value="{!caseObj.License__c}" maxlength="9" size="25" styleClass="textfield"/>
		    <br/><img src="{!URLFOR($Resource.helpicon)}" width="11" height="11" alt="" /><a href='#' onClick="javascript:window.open('{!$Label.mw_domain_url}/support/contact_us/ts/popups/licensenum.html','_blank','width=1000,height=600,scrollbars=yes,menubar=no,toolbar=no,location=no,status=no,resizable=yes');return false;" >How do I get my license number?</a>
		  </div>
		  <div class="form_element" id="add_additional_details_6div" name="Notes">
		    <label for="add_additional_details_6"><span class="req" id="add_additional_details_6span">*</span>Description</label>
		    <apex:inputTextArea richtext="false" id="add_additional_details_6" value="{!caseObj.Description}" cols="60" rows="6" styleClass="textarea" style="width:99%;"/>
		  </div>
		    <input type="button" value="Cancel"  id="cancelButton" class="mwbutton rounded" onclick="createcancel();" style="margin-right:10px; float:right;"/>
		    <input type="button" value="Submit" id="submitbutton" class="mwbutton rounded" onclick="checkRequiredFields(visitorChoice,'GeneralCustomerService');" style="margin-right:10px; float:right;"/>
		    <!--<apex:commandButton value="Cancel" styleclass="mwbutton rounded" onclick="createcancel();" style="margin-left:10px;margin-top:2px" rendered="{!isDistributor}" />-->
		    
		            <apex:actionstatus id="saving">
		                <apex:facet name="start">
		                    <img alt="waiting" src="http://mathworks.com/images/spinner.gif" border="0" /> Saving...
		                </apex:facet>
		            </apex:actionstatus>
  <script>
          var requiredFieldId = '';
          var requiredFieldArr = new Array();
          if ( '{!isStudent}' == 'false' ){
              requiredFieldArr['a1'] = '{!$Component.title_1},{!$Component.License__c_1},{!$Component.add_additional_details_1}';
              requiredFieldArr['a2'] = '{!$Component.title_2}'+','+'{!$Component.service_license___2}'+','+'{!$Component.what_would_you_like_to_do__2}'+','+'{!$Component.ihPassCodeRelease_2}'+','+'{!$Component.Add_additional_details_to_your_request__2}';
              requiredFieldArr['a2b'] = '{!$Component.title_2},{!$Component.service_license___2},{!$Component.what_would_you_like_to_do__2},{!$Component.ihPassCodeRelease_2},{!$Component.cus_firstname},{!$Component.cus_lastname},{!$Component.cus_email},{!$Component.Add_additional_details_to_your_request__2}';
              requiredFieldArr['a3'] = '{!$Component.ihCSLicenseContact_3},{!$Component.ihCSContactRequest_3},{!$Component.license_3},{!$Component.first_name_a_3},{!$Component.last_name_a_3},{!$Component.email_a_3},{!$Component.selCountry_a_3},{!$Component.first_name_b_3},{!$Component.last_name_b_3},{!$Component.companyUniversity_b_3},{!$Component.newStreetAddress1_b_3},{!$Component.newCity_b_3},{!$Component.zip_code_b_3},{!$Component.email_b_3},{!$Component.phone_b_3}';
              requiredFieldArr['a4'] = '{!$Component.title_4},{!$Component.Transfer_product1_4},{!$Component.quantity1_4},{!$Component.from1_4},{!$Component.to1_4}';
              requiredFieldArr['a4b'] = '{!$Component.title_4},{!$Component.Transfer_product1_4},{!$Component.quantity1_4},{!$Component.from1_4},{!$Component.to1_4},{!$Component.cus_firstname},{!$Component.cus_lastname},{!$Component.cus_email}';
              requiredFieldArr['a5'] = '{!$Component.title_5},{!$Component.license_5},{!$Component.listLicensesToCombine_5}';
              requiredFieldArr['a5b'] = '{!$Component.title_5},{!$Component.license_5},{!$Component.listLicensesToCombine_5},{!$Component.cus_firstname},{!$Component.cus_lastname},{!$Component.cus_email}';
              //requiredFieldArr['a6'] = '{!$Component.title_6},{!$Component.csgcslicense_6},{!$Component.add_additional_details_6}';
              //requiredFieldArr['a6b'] = '{!$Component.title_6},{!$Component.csgcslicense_6},{!$Component.cus_firstname},{!$Component.cus_lastname},{!$Component.cus_email},{!$Component.add_additional_details_6}';
              requiredFieldArr['a6'] = '{!$Component.add_additional_details_6}';
              requiredFieldArr['a6b'] = '{!$Component.cus_firstname},{!$Component.cus_lastname},{!$Component.cus_email},{!$Component.add_additional_details_6}';
              requiredFieldArr['b1'] = '{!$Component.license_7},{!$Component.platform_7},{!$Component.OS_7},{!$Component.releaselists_7},{!$Component.allproductlist_7},{!$Component.title_7},{!$Component.how_can_we_assist_7}';
              requiredFieldArr['b2'] = '{!$Component.summary_8},{!$Component.description_8},{!$Component.ver_8},{!$Component.product_8},{!$Component.release_8}';
          }
          else{
              requiredFieldArr['a1'] = '{!$Component.title_1}'+','+'{!$Component.add_additional_details_1}';
              requiredFieldArr['a2'] = '{!$Component.title_2}'+','+'{!$Component.service_license___2}'+','+'{!$Component.what_would_you_like_to_do__2}'+','+'{!$Component.ihPassCodeRelease_2}'+','+'{!$Component.Add_additional_details_to_your_request__2}';
              requiredFieldArr['a2b'] = '{!$Component.title_2}'+','+'{!$Component.service_license___2}'+','+'{!$Component.what_would_you_like_to_do__2}'+','+'{!$Component.ihPassCodeRelease_2}'+','+'{!$Component.cus_firstname}'+','+'{!$Component.cus_lastname}'+','+'{!$Component.cus_email}'+','+'{!$Component.Add_additional_details_to_your_request__2}';
              requiredFieldArr['a3'] = '{!$Component.ihCSLicenseContact_3}'+','+'{!$Component.ihCSContactRequest_3}'+','+'{!$Component.license_3}'+','+'{!$Component.first_name_a_3}'+','+'{!$Component.last_name_a_3}'+','+'{!$Component.email_a_3}'+','+'{!$Component.selCountry_a_3}'+','+'{!$Component.first_name_b_3}'+','+'{!$Component.last_name_b_3}'+','+'{!$Component.companyUniversity_b_3}'+','+'{!$Component.newStreetAddress1_b_3}'+','+'{!$Component.newCity_b_3}'+','+'{!$Component.zip_code_b_3}'+','+'{!$Component.email_b_3}'+','+'{!$Component.phone_b_3}';
              requiredFieldArr['a4'] = '{!$Component.title_4}'+','+'{!$Component.Transfer_product1_4}'+','+'{!$Component.quantity1_4}'+','+'{!$Component.from1_4}'+','+'{!$Component.to1_4}';
              requiredFieldArr['a4b'] = '{!$Component.title_4}'+','+'{!$Component.Transfer_product1_4}'+','+'{!$Component.quantity1_4}'+','+'{!$Component.from1_4}'+','+'{!$Component.to1_4}'+','+'{!$Component.cus_firstname}'+','+'{!$Component.cus_lastname}'+','+'{!$Component.cus_email}';
              requiredFieldArr['a5'] = '{!$Component.title_5}'+','+'{!$Component.license_5}'+','+'{!$Component.listLicensesToCombine_5}';
              requiredFieldArr['a5b'] = '{!$Component.title_5}'+','+'{!$Component.license_5}'+','+'{!$Component.listLicensesToCombine_5}'+','+'{!$Component.cus_firstname}'+','+'{!$Component.cus_lastname}'+','+'{!$Component.cus_email}';
              //requiredFieldArr['a6'] = '{!$Component.title_6}'+','+'{!$Component.add_additional_details_6}';
              //requiredFieldArr['a6b'] = '{!$Component.title_6}'+','+'{!$Component.cus_firstname}'+','+'{!$Component.cus_lastname}'+','+'{!$Component.cus_email}'+','+'{!$Component.add_additional_details_6}';
              requiredFieldArr['a6'] = '{!$Component.add_additional_details_6}';
              requiredFieldArr['a6b'] = '{!$Component.cus_firstname}'+','+'{!$Component.cus_lastname}'+','+'{!$Component.cus_email}'+','+'{!$Component.add_additional_details_6}';
              requiredFieldArr['b1'] = '{!$Component.platform_7}'+','+'{!$Component.OS_7}'+','+'{!$Component.releaselists_7}'+','+'{!$Component.allproductlist_7}'+','+'{!$Component.title_7}'+','+'{!$Component.how_can_we_assist_7}';
              requiredFieldArr['b2'] = '{!$Component.summary_8},{!$Component.description_8},{!$Component.ver_8},{!$Component.product_8},{!$Component.release_8}';
          }
          
          var dependencyField = new Array();// index is the id of the required field and value is the dependent radio button id seperated by '%2C'.
          dependencyField['{!$Component.ihPassCodeRelease_2}'] = "Request a passcode/license file";
          dependencyField['{!$Component.first_name_a_3}'] = "changeContact%2CremoveContact";
          dependencyField['{!$Component.last_name_a_3}'] = "changeContact%2CremoveContact";
          dependencyField['{!$Component.email_a_3}'] = "changeContact%2CremoveContact";
          dependencyField['{!$Component.selCountry_a_3}'] = "changeContact%2CaddContact";
          dependencyField['{!$Component.first_name_b_3}'] = "changeContact%2CaddContact";
          dependencyField['{!$Component.last_name_b_3}'] = "changeContact%2CaddContact";
          dependencyField['{!$Component.companyUniversity_b_3}'] = "changeContact%2CaddContact";
          dependencyField['{!$Component.newStreetAddress1_b_3}'] = "changeContact%2CaddContact";
          dependencyField['{!$Component.newCity_b_3}'] = "changeContact%2CaddContact";
          dependencyField['{!$Component.zip_code_b_3}'] = "changeContact%2CaddContact";
          dependencyField['{!$Component.email_b_3}'] = "changeContact%2CaddContact";
          dependencyField['{!$Component.phone_b_3}'] = "changeContact%2CaddContact";
          
          var licenseFieldArr = new Array();
          licenseFieldArr['a1'] = '{!$Component.License__c_1}';
          licenseFieldArr['a2'] = '{!$Component.service_license___2}';
          licenseFieldArr['a2b'] = '{!$Component.service_license___2}';
          licenseFieldArr['a3'] = '{!$Component.license_3}';
          licenseFieldArr['a4'] = '{!$Component.from1_4},{!$Component.to1_4},{!$Component.from2},{!$Component.to2},{!$Component.from3},{!$Component.to3},{!$Component.from4},{!$Component.to4},{!$Component.from5},{!$Component.to5}';
          licenseFieldArr['a4b'] = '{!$Component.from1_4},{!$Component.to1_4},{!$Component.from2},{!$Component.to2},{!$Component.from3},{!$Component.to3},{!$Component.from4},{!$Component.to4},{!$Component.from5},{!$Component.to5}';
          licenseFieldArr['a5'] = '{!$Component.license_5}';
          licenseFieldArr['a5b'] = '{!$Component.license_5}';
          licenseFieldArr['a6'] = '{!$Component.csgcslicense_6}';
          licenseFieldArr['a6b'] = '{!$Component.csgcslicense_6}';
          licenseFieldArr['b1'] = '{!$Component.license_7}';       
     </script>

        </apex:form>
          
         </apex:outputPanel>    
         </apex:outputPanel>  
         </apex:outputPanel> 
         </apex:outputPanel>  
         </apex:outputPanel> 
           <div class="grid_192"> <div class="footer_container">
            <div class="footer">
           <div class="copyright"> Â© 1994-{!year(today())} The MathWorks, Inc.</div>
           </div>
           </div>
           </div>
        </apex:outputPanel> 
        </body>  
</apex:page>